<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://nant.sf.net/schemas/nant.xsd" name="IntegrationTest Build" default="Triggered">

  <property name="CCNetBuildCondition" value="ForceBuild "/>
  <property name="CCNetIntegrationStatus" value="Success"/>
  <property name="CCNetLastIntegrationStatus" value="Success"/>
  <property name="CCNetBuildDate" value="2005-01-01"/>
  <property name="CCNetBuildTime" value="00:00:01"/>
  <property name="CCNetArtifactDirectory" value="C:\Temp\CCNetArtifactDirectory"/>
  <property name="CCNetWorkingDirectory" value="C:\Temp\CCNetWorkingDirectory"/>
  <property name="CCNetLabel" value="Personal.1"/>
  <property name="CCNetLogFilePath" value=""/>

  <include buildfile="Properties.Build.xml"/>
  <property name="CCNetProject" value="${ProjectName}"/>
  <property name="Compile.ConfigName" value="Debug"/>

  <include buildfile="Common.Build.xml" />

  <description>Begin Package Includes</description>
  <include buildfile="${PackagesDirectory}\Deployment\Deployment.Target.xml" if="${file::exists(PackagesDirectory + '\Deployment\Deployment.Target.xml')}"/>
  <include buildfile="${PackagesDirectory}\Workspace\Workspace.Targets.xml" if="${file::exists(PackagesDirectory + '\Workspace\Workspace.Targets.xml')}"/>
  <include buildfile="${PackagesDirectory}\soapui\soapui.Target.xml" />
  <description>End Package Includes</description>
  
  <target name="Triggered" depends="SetUps" >
    <trycatch>
      <try>
        <property name="CCNetRemotingUrl" value="tcp://${BuildServerHostName}:${BuildServerPort}/CruiseManager.rem"/>
        <property name="NightlyProjectName" value="${ProjectName}-${ProjectCodeLineName} Nightly Build"/>
        <property name="NightlyBuildArchiveFolderName" value="${ccnet::get-project-last-build-date(CCNetRemotingUrl, NightlyProjectName)}"/>

        <get
          dest="${Common.ReportDirectory}\${ProjectName}TargetProcesss.xml"
          src="http://${BuildServerHostName}/${ProjectName}-${ProjectCodeLineName}/Artifacts/${NightlyBuildArchiveFolderName}/${ProjectName}TargetProcesss.xml"
        />

				<call target="SoapUI.Deploy"/>
      </try>
      <finally>
				<copy failonerror="false" overwrite="true" tofile="${Common.ArtifactDirectoryPath}\unittests.xml" verbose="true" file="${BuildDirectory}\SoapUITestReports\IntegrationTests.xml"/>      	      	
				<copy failonerror="false" overwrite="true" todir="${Common.ArtifactDirectoryPath}" verbose="true" file="${BuildDirectory}\SoapUITestReports\IntegrationTests.xml"/>      	      	
        <call target="TearDowns" />
      </finally>
    </trycatch>

  </target>

  <target name="SetUps">
    <call target="Common.SetUp" />
    <description>Begin SetUps</description>
    <call target="SoapUI.SetUp" />
    <description>End SetUps</description>
  </target>

  <target name="TearDowns">
    <description>Begin TearDowns</description>
    <call target="SoapUI.TearDown" />
    <description>End TearDowns</description>
  </target>
</project>