<?xml version="1.0" encoding="UTF-8"?>
<process
    name="EntityNotify"
    targetNamespace="urn:gov:hhs:fha:nhinc:gateway:entitybpel:entitynotify"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor"
    xmlns:sxat="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Attachment"
    xmlns:sxeh="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling"
    xmlns:tns="urn:gov:hhs:fha:nhinc:gateway:entitybpel:entitynotify" 
    xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon">
    <import namespace="urn:gov:hhs:fha:nhinc:entitynotificationconsumer" location="Interfaces/wsdl/EntityNotificationConsumer.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="urn:gov:hhs:fha:nhinc:entitycomponentinternalnotifyorch" location="Interfaces/wsdl/EntityComponentInternalNotifyOrch.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcnotifyorch" location="Interfaces/wsdl/EntityComponentInternalCdcNotifyOrch.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <partnerLinks>
        <partnerLink name="DocumentNotifyPL" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalnotifyorch" partnerLinkType="tns:EntityComponentInternalNotifyOrch" partnerRole="EntityComponentInternalNotifyOrchPortTypeRole"/>
        <partnerLink name="CdcNotifyPL" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcnotifyorch" partnerLinkType="tns:EntityComponentInternalCdcNotifyOrch" partnerRole="EntityComponentInternalCdcNotifyOrchPortTypeRole"/>
        <partnerLink name="EntityNotifyPL" xmlns:tns="urn:gov:hhs:fha:nhinc:entitynotificationconsumer" partnerLinkType="tns:EntityNotificationConsumer" myRole="EntityNotificationConsumerPortTypeRole"/>
    </partnerLinks>
    <variables>
        <variable name="NotifySubscribersOfCdcBioPackageIn" xmlns:tns="urn:gov:hhs:fha:nhinc:entitynotificationconsumer" messageType="tns:NotifySubscribersOfCdcBioPackageRequestMessage"/>
        <variable name="NotifySubscribersOfDocumentIn" xmlns:tns="urn:gov:hhs:fha:nhinc:entitynotificationconsumer" messageType="tns:NotifySubscribersOfDocumentRequestMessage"/>
    </variables>
    <sequence>
        <pick name="PickNotifyMessages" createInstance="yes">
            <onMessage partnerLink="EntityNotifyPL" operation="NotifySubscribersOfDocument" xmlns:tns="urn:gov:hhs:fha:nhinc:entitynotificationconsumer" portType="tns:EntityNotificationConsumerPortType" variable="NotifySubscribersOfDocumentIn">
                <scope name="ProcessDocumentNotifyScope">
                    <variables>
                        <variable name="DocumentNotifyOut" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalnotifyorch" messageType="tns:DocumentNotifyResponseMessage"/>
                        <variable name="DocumentNotifyIn" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalnotifyorch" messageType="tns:DocumentNotifyRequestMessage"/>
                        <variable name="NotifySubscribersOfDocumentOut" messageType="tns:NotifySubscribersOfDocumentResponseMessage"/>
                    </variables>
                    <faultHandlers>
                        <catch faultName="sxeh:systemFault" faultVariable="systemFaultDocNotifyVar" faultMessageType="sxeh:faultMessage">
                            <sequence name="SystemFaultCdcNotifySeq">
                                <assign name="AssignDocNotifyFault">
                                    <sxt:trace>
                                        <sxt:log level="info" location="onStart">
                                            <from>'EntityNotify.bpel - A system fault was encounterd processing a Document Notify message. Fault detials follow...'</from>
                                        </sxt:log>
                                        <sxt:log level="warning" location="onStart">
                                            <from variable="systemFaultDocNotifyVar"/>
                                        </sxt:log>
                                    </sxt:trace>
                                    <copy>
                                        <from>'Internal Gateway Error'</from>
                                        <to>$NotifySubscribersOfDocumentOut.NotifySubscribersOfDocumentResponse/nccommon:message</to>
                                    </copy>
                                </assign>
                                <reply name="ReplyDocNotifyFault" partnerLink="EntityNotifyPL" operation="NotifySubscribersOfDocument" portType="tns:EntityNotificationConsumerPortType" variable="NotifySubscribersOfDocumentOut"/>
                            </sequence>
                        </catch>
                    </faultHandlers>
                    <sequence name="ProcessDocumentNotifySeq">
                        <empty name="AuditDocNotifyReq"/>
                        <assign name="AssignEntityDocumentNotify">
                            <copy>
                                <from variable="NotifySubscribersOfDocumentIn" part="NotifySubscribersOfDocumentRequest"/>
                                <to variable="DocumentNotifyIn" part="DocumentNotifyRequest"/>
                            </copy>
                        </assign>
                        <invoke name="InvokeEntityDocumentNotify" partnerLink="DocumentNotifyPL" operation="DocumentNotify" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalnotifyorch" portType="tns:EntityComponentInternalNotifyOrchPortType" inputVariable="DocumentNotifyIn" outputVariable="DocumentNotifyOut"/>
                        <assign name="AssignDocNotifyResp">
                            <copy>
                                <from variable="DocumentNotifyOut" part="DocumentNotifyResponse"/>
                                <to variable="NotifySubscribersOfDocumentOut" part="NotifySubscribersOfDocumentResponse"/>
                            </copy>
                        </assign>
                        <empty name="AuditDocNotifyResp"/>
                        <reply name="ReplyDocNotify" partnerLink="EntityNotifyPL" operation="NotifySubscribersOfDocument" portType="tns:EntityNotificationConsumerPortType" variable="NotifySubscribersOfDocumentOut"/>
                    </sequence>
                </scope>
            </onMessage>
            <onMessage partnerLink="EntityNotifyPL" operation="NotifySubscribersOfCdcBioPackage" xmlns:tns="urn:gov:hhs:fha:nhinc:entitynotificationconsumer" portType="tns:EntityNotificationConsumerPortType" variable="NotifySubscribersOfCdcBioPackageIn">
                <scope name="ProcessCdcNotifyScope">
                    <variables>
                        <variable name="CdcNotifyOut" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcnotifyorch" messageType="tns:CdcNotifyResponseMessage"/>
                        <variable name="CdcNotifyIn" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcnotifyorch" messageType="tns:CdcNotifyRequestMessage"/>
                        <variable name="NotifySubscribersOfCdcBioPackageOut" messageType="tns:NotifySubscribersOfCdcBioPackageResponseMessage"/>
                    </variables>
                    <faultHandlers>
                        <catch faultName="sxeh:systemFault" faultVariable="systemFaultCdcNotifyVar" faultMessageType="sxeh:faultMessage">
                            <sequence name="SystemFaultCdcNotifySeq">
                                <assign name="AssignCdcNotifyFault">
                                    <sxt:trace>
                                        <sxt:log level="info" location="onStart">
                                            <from>'EntityNotify.bpel - A system fault was encounterd processing a Cdc Notify message. Fault detials follow...'</from>
                                        </sxt:log>
                                        <sxt:log level="warning" location="onStart">
                                            <from variable="systemFaultCdcNotifyVar"/>
                                        </sxt:log>
                                    </sxt:trace>                                    
                                    <copy>
                                        <from>'Internal Gateway Error'</from>
                                        <to>$NotifySubscribersOfCdcBioPackageOut.NotifySubscribersOfCdcBioPackageResponse/nccommon:message</to>
                                    </copy>
                                </assign>
                                <reply name="ReplyCdcNotifyFault" partnerLink="EntityNotifyPL" operation="NotifySubscribersOfCdcBioPackage" portType="tns:EntityNotificationConsumerPortType" variable="NotifySubscribersOfCdcBioPackageOut"/>
                            </sequence>
                        </catch>
                    </faultHandlers>
                    <sequence name="ProcessCdcNotifySeq">
                        <empty name="AuditCdcNotifyReq"/>
                        <assign name="AssignEntityCdcNotify">
                            <copy>
                                <from variable="NotifySubscribersOfCdcBioPackageIn" part="NotifySubscribersOfCdcBioPackageRequest"/>
                                <to variable="CdcNotifyIn" part="CdcNotifyRequest"/>
                            </copy>
                        </assign>
                        <invoke name="InvokeEntityCdcNotify" partnerLink="CdcNotifyPL" operation="CdcNotify" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcnotifyorch" portType="tns:EntityComponentInternalCdcNotifyOrchPortType" inputVariable="CdcNotifyIn" outputVariable="CdcNotifyOut"/>
                        <assign name="AssignCdcNotifyResp">
                            <copy>
                                <from variable="CdcNotifyOut" part="CdcNotifyResponse"/>
                                <to variable="NotifySubscribersOfCdcBioPackageOut" part="NotifySubscribersOfCdcBioPackageResponse"/>
                            </copy>
                        </assign>
                        <empty name="AuditCdcNotifyResp"/>
                        <reply name="ReplyCdcNotify" partnerLink="EntityNotifyPL" operation="NotifySubscribersOfCdcBioPackage" portType="tns:EntityNotificationConsumerPortType" variable="NotifySubscribersOfCdcBioPackageOut"/>
                    </sequence>
                </scope>
            </onMessage>
        </pick>
    </sequence>
</process>
