<?xml version="1.0" encoding="UTF-8"?>
<process
    name="EntitySubscription"
    targetNamespace="urn:gov:hhs:fha:nhinc:gateway:entitybpel:entitysubscription"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor"
    xmlns:sxat="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Attachment"
    xmlns:sxeh="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling"
    xmlns:tns="urn:gov:hhs:fha:nhinc:gateway:entitybpel:entitysubscription" 
    xmlns:sxxf="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/XPathFunctions" 
    xmlns:wsnt="http://docs.oasis-open.org/wsn/b-2">
    <import namespace="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement" location="Interfaces/wsdl/EntitySubscriptionManagement.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://docs.oasis-open.org/wsrf/rw-2" location="Interfaces/wsdl/rw-2.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="urn:gov:hhs:fha:nhinc:nhinccomponentinternalauditrepository" location="Interfaces/wsdl/NhincComponentInternalAuditRepository.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="urn:gov:hhs:fha:nhinc:entitycomponentinternalsubscribeorch" location="Interfaces/wsdl/EntityComponentInternalSubscribeOrch.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcsubscribeorch" location="Interfaces/wsdl/EntityComponentInternalCdcSubscribeOrch.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <partnerLinks>
        <partnerLink name="AuditRepositoryPL" xmlns:tns="urn:gov:hhs:fha:nhinc:nhinccomponentinternalauditrepository" partnerLinkType="tns:NhincComponentInternalAuditRepository" partnerRole="NhincComponentInternalAuditRepositoryPortTypeRole"/>
        <partnerLink name="EntityInternalSubscribePL" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalsubscribeorch" partnerLinkType="tns:EntityComponentInternalSubscribeOrch" partnerRole="EntityComponentInternalSubscribeOrchPortTypeRole"/>
        <partnerLink name="EntityInternalCdcSubscribePL" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcsubscribeorch" partnerLinkType="tns:EntityComponentInternalCdcSubscribeOrch" partnerRole="EntityComponentInternalCdcSubscribeOrchPortTypeRole"/>
        <partnerLink name="EntitySubscriptionPL" xmlns:tns="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement" partnerLinkType="tns:EntityNotificationProducer" myRole="EntityNotificationProducerPortTypeRole"/>
    </partnerLinks>
    <variables>
        <variable name="SubscribeCdcBioPackageIn" xmlns:tns="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement" messageType="tns:SubscribeCdcBioPackageRequestMessage"/>
        <variable name="SubscribeDocumentIn" xmlns:tns="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement" messageType="tns:SubscribeDocumentRequestMessage"/>
    </variables>
    <sequence>
        <pick name="PickSubscriptionMessages" createInstance="yes">
            <onMessage partnerLink="EntitySubscriptionPL" operation="SubscribeDocument" xmlns:tns="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement" portType="tns:EntityNotificationProducerPortType" variable="SubscribeDocumentIn">
                <scope name="ProcessSubscribeScope">
                    <variables>
                        <variable name="EntityInternalSubscribeOut" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalsubscribeorch" messageType="tns:SubscribeDocumentResponseMessage"/>
                        <variable name="EntityInternalSubscribeIn" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalsubscribeorch" messageType="tns:SubscribeDocumentRequestMessage"/>
                        <variable name="SubscribeDocumentOut" messageType="tns:SubscribeDocumentResponseMessage"/>
                    </variables>
                    <faultHandlers>
                        <catch>
                            <sequence name="SubscriptionFaultSeq">
                                <assign name="AssignSubscriptionFault">
                                    <copy>
                                        <from>sxxf:current-dateTime()</from>
                                        <to>$SubscribeDocumentOut.SubscribeDocumentResponse/wsnt:SubscribeResponse/wsnt:CurrentTime</to>
                                    </copy>
                                    <copy>
                                        <from>sxxf:current-dateTime()</from>
                                        <to>$SubscribeDocumentOut.SubscribeDocumentResponse/wsnt:SubscribeResponse/wsnt:TerminationTime</to>
                                    </copy>
                                </assign>
                                <reply name="ReplySubscriptionFault" partnerLink="EntitySubscriptionPL" operation="SubscribeDocument" portType="tns:EntityNotificationProducerPortType" variable="SubscribeDocumentOut"/>
                            </sequence>
                        </catch>
                    </faultHandlers>
                    <sequence name="ProcessSubscribeSeq">
                        <empty name="Placeholder_Auidt_Request"/>
                        <assign name="AssignEntityInternalSubscribe">
                            <copy>
                                <from variable="SubscribeDocumentIn" part="SubscribeDocumentRequest"/>
                                <to variable="EntityInternalSubscribeIn" part="SubscribeDocumentRequest"/>
                            </copy>
                        </assign>
                        <invoke name="InvokeEntityInternalSubscribe" partnerLink="EntityInternalSubscribePL" operation="SubscribeDocument" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalsubscribeorch" portType="tns:EntityComponentInternalSubscribeOrchPortType" inputVariable="EntityInternalSubscribeIn" outputVariable="EntityInternalSubscribeOut"/>
                        <assign name="AssignReply">
                            <copy>
                                <from>$EntityInternalSubscribeOut.SubscribeDocumentResponse/wsnt:SubscribeResponse</from>
                                <to>$SubscribeDocumentOut.SubscribeDocumentResponse/wsnt:SubscribeResponse</to>
                            </copy>
                        </assign>
                        <empty name="Placeholder_Audit_Response"/>
                        <reply name="ReplySubscription" partnerLink="EntitySubscriptionPL" operation="SubscribeDocument" portType="tns:EntityNotificationProducerPortType" variable="SubscribeDocumentOut"/>
                    </sequence>
                </scope>
            </onMessage>
            <onMessage partnerLink="EntitySubscriptionPL" operation="SubscribeCdcBioPackage" xmlns:tns="urn:gov:hhs:fha:nhinc:entitysubscriptionmanagement" portType="tns:EntityNotificationProducerPortType" variable="SubscribeCdcBioPackageIn">
                <scope name="ProcessCdcSubscribeScope">
                    <variables>
                        <variable name="EntityInternalCdcSubscribeOut" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcsubscribeorch" messageType="tns:CdcSubscribeDocumentResponseMessage"/>
                        <variable name="EntityInternalCdcSubscribeIn" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcsubscribeorch" messageType="tns:CdcSubscribeDocumentRequestMessage"/>
                        <variable name="SubscribeCdcBioPackageOut" messageType="tns:SubscribeCdcBioPackageResponseMessage"/>
                    </variables>
                    <faultHandlers>
                        <catch>
                            <sequence name="CdcSubscriptionFaultSeq">
                                <assign name="AssignCdcSubscriptionFault">
                                    <copy>
                                        <from>sxxf:current-dateTime()</from>
                                        <to>$SubscribeCdcBioPackageOut.SubscribeCdcBioPackageResponse/wsnt:SubscribeResponse/wsnt:CurrentTime</to>
                                    </copy>
                                    <copy>
                                        <from>sxxf:current-dateTime()</from>
                                        <to>$SubscribeCdcBioPackageOut.SubscribeCdcBioPackageResponse/wsnt:SubscribeResponse/wsnt:TerminationTime</to>
                                    </copy>
                                </assign>
                                <reply name="ReplyCdcSubscriptionFault" partnerLink="EntitySubscriptionPL" operation="SubscribeCdcBioPackage" portType="tns:EntityNotificationProducerPortType" variable="SubscribeCdcBioPackageOut"/>
                            </sequence>
                        </catch>
                    </faultHandlers>
                    <sequence name="ProcessCdcSubscribeSeq">
                        <empty name="Placeholder_Audit_Request"/>
                        <assign name="AssignEntityInternalCdcSubscribe">
                            <copy>
                                <from variable="SubscribeCdcBioPackageIn" part="SubscribeCdcBioPackageRequest"/>
                                <to variable="EntityInternalCdcSubscribeIn" part="CdcSubscribeDocumentRequest"/>
                            </copy>
                        </assign>
                        <invoke name="InvokeEntityInternalCdcSubscribe" partnerLink="EntityInternalCdcSubscribePL" operation="CdcSubscribeDocument" xmlns:tns="urn:gov:hhs:fha:nhinc:entitycomponentinternalcdcsubscribeorch" portType="tns:EntityComponentInternalCdcSubscribeOrchPortType" inputVariable="EntityInternalCdcSubscribeIn" outputVariable="EntityInternalCdcSubscribeOut"/>
                        <assign name="AssignCdcSubscription">
                            <copy>
                                <from>$EntityInternalCdcSubscribeOut.CdcSubscribeDocumentResponse/wsnt:SubscribeResponse</from>
                                <to>$SubscribeCdcBioPackageOut.SubscribeCdcBioPackageResponse/wsnt:SubscribeResponse</to>
                            </copy>
                        </assign>
                        <empty name="Placeholder_Audit_Response"/>
                        <reply name="ReplyCdcSubscription" partnerLink="EntitySubscriptionPL" operation="SubscribeCdcBioPackage" portType="tns:EntityNotificationProducerPortType" variable="SubscribeCdcBioPackageOut"/>
                    </sequence>
                </scope>
            </onMessage>
        </pick>
    </sequence>
</process>
