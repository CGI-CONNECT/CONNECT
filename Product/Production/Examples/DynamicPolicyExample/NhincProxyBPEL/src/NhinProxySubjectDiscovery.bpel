<?xml version="1.0" encoding="UTF-8"?>
<process
    name="NhinProxySubjectDiscovery"
    targetNamespace="urn:gov:hhs:fha:nhinc:gateway:nhincproxybpel:nhinproxysubjectdiscovery"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor"
    xmlns:sxeh="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling"
    xmlns:tns="urn:gov:hhs:fha:nhinc:gateway:nhincproxybpel:nhinproxysubjectdiscovery"
    xmlns:hl7="urn:hl7-org:v3"
    xmlns:bpel="http://docs.oasis-open.org/wsbpel/2.0/process/executable" 
    xmlns:nccommon="urn:gov:hhs:fha:nhinc:common:nhinccommon" 
    xmlns:ns0="http://schemas.xmlsoap.org/ws/2004/08/addressing">
    <import namespace="urn:gov:hhs:fha:nhinc:nhincproxysubjectdiscovery" location="Interfaces/wsdl/NhincProxySubjectDiscovery.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://enterprise.netbeans.org/bpel/NhinSubjectDiscoveryWrapper" location="NhinSubjectDiscoveryWrapper.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="urn:ihe:iti:pixv3:2007" location="Interfaces/wsdl/NhinSubjectDiscovery.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="urn:gov:hhs:fha:nhinc:nhinccomponenttokeninfomanager" location="Interfaces/wsdl/NhincComponentTokenInfoManager.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <partnerLinks>
        <partnerLink name="TokenInfoMgrPL" xmlns:tns="urn:gov:hhs:fha:nhinc:nhinccomponenttokeninfomanager" partnerLinkType="tns:NhincComponentTokenInfoManager" partnerRole="NhincComponentTokenInfoManagerPortTypeRole"/>
        <partnerLink name="NhinSubjectDiscoveryPL" xmlns:tns="http://enterprise.netbeans.org/bpel/NhinSubjectDiscoveryWrapper" partnerLinkType="tns:PIXConsumer_LinkType" partnerRole="PIXConsumer_Role"/>
        <partnerLink name="NhincProxySubjectDiscoveryPL" xmlns:tns="urn:gov:hhs:fha:nhinc:nhincproxysubjectdiscovery" partnerLinkType="tns:NhincProxySubjectDiscovery" myRole="NhincProxySubjectDiscoveryPortTypeRole"/>
    </partnerLinks>
    <variables>
        <variable name="PIX201301In" xmlns:tns="urn:gov:hhs:fha:nhinc:nhincproxysubjectdiscovery" messageType="tns:PIXConsumer_PRPA_IN201301UVRequestMessage"/>
    </variables>
    <sequence>
        <pick name="HandleSubDiscoveryMessageSeq" createInstance="yes">
            <onMessage partnerLink="NhincProxySubjectDiscoveryPL" operation="PIXConsumer_PRPA_IN201301UV" xmlns:tns="urn:gov:hhs:fha:nhinc:nhincproxysubjectdiscovery" portType="tns:NhincProxySubjectDiscoveryPortType" variable="PIX201301In">
                <scope name="Handle201301Scope">
                    <variables>
                        <variable name="StoreAssertionIn" xmlns:tns="urn:gov:hhs:fha:nhinc:nhinccomponenttokeninfomanager" messageType="tns:StoreInfoOperationRequest"/>
                        <variable name="PIX201301OutgoingOut" xmlns:tns="urn:ihe:iti:pixv3:2007" messageType="tns:MCCI_IN000002UV01_Message"/>
                        <variable name="PIX201301OutgoingIn" xmlns:tns="urn:ihe:iti:pixv3:2007" messageType="tns:PRPA_IN201301UV_Message"/>
                        <variable name="PIX201301Out" messageType="tns:PIXConsumer_PRPA_IN201301UVResponseMessage"/>
                    </variables>
                    <sequence name="Send201301Seq">
                        <assign name="AssignStoreAssertion">
                            <copy>
                                <from>$PIX201301In.PIXConsumer_PRPA_IN201301UVRequest/hl7:assertion</from>
                                <to>$StoreAssertionIn.infoIn/nccommon:assertion</to>
                            </copy>
                            <copy>
                                <from>'subjectDiscovery'</from>
                                <to>$StoreAssertionIn.infoIn/nccommon:actionName</to>
                            </copy>
                        </assign>
                        <invoke name="InvokeStoreAssertion" partnerLink="TokenInfoMgrPL" operation="StoreInfoOperation" xmlns:tns="urn:gov:hhs:fha:nhinc:nhinccomponenttokeninfomanager" portType="tns:NhincComponentTokenInfoManagerPortType" inputVariable="StoreAssertionIn"/>
                        <assign name="AssignSendToGateway">
                            <copy>
                                <from>$PIX201301In.PIXConsumer_PRPA_IN201301UVRequest/hl7:PRPA_IN201301UV</from>
                                <to variable="PIX201301OutgoingIn" part="Body"/>
                            </copy>
                        </assign>
                        <invoke name="InvokeSendToGateway" partnerLink="NhinSubjectDiscoveryPL" operation="PIXConsumer_PRPA_IN201301UV" xmlns:tns="urn:ihe:iti:pixv3:2007" portType="tns:PIXConsumer_PortType" inputVariable="PIX201301OutgoingIn" outputVariable="PIX201301OutgoingOut"/>
                        <assign name="Assign201301Resp">
                            <copy>
                                <from variable="PIX201301OutgoingOut" part="Body"/>
                                <to variable="PIX201301Out" part="PIXConsumer_PRPA_IN201301UVResponse"/>
                            </copy>
                        </assign>
                        <reply name="Reply201301" partnerLink="NhincProxySubjectDiscoveryPL" operation="PIXConsumer_PRPA_IN201301UV" portType="tns:NhincProxySubjectDiscoveryPortType" variable="PIX201301Out"/>
                    </sequence>
                </scope>
            </onMessage>
        </pick>
    </sequence>
</process>
