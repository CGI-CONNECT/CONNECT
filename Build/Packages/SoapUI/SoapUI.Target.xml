<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://nant.sf.net/schemas/nant.xsd" name="SoapUI.Target">

  <include buildfile="SoapUI.Properties.xml" />

  <target name="SoapUI.RunTests">
		<copy 
      file="${SoapUI.Property.File.Path}"  
      tofile="${SoapUI.Root.Directory.Path}\default.properties" 
      overwrite="true"
    />
    
	  <trycatch>
		  <try>	  	
			  <exec program="${Ant.Bat}">
				  <environment refid="${Ant.Environment.RefId}" />
				  <arg line="-buildfile ${BuildDirectory}\Packages\SoapUI\SoapUI.Ant.Target.xml" />
			  </exec>
        <property name="Ant.Failure" value="False"/>
		  </try>
      <catch property="exception">
        <echo level="Error" message="${exception}"/>
        <property name="Ant.Failure" value="True"/>
      </catch>
	  </trycatch>
    
    <copy
			file='${SoapUI.Intermediate.Report.File.Path}'
			todir='${SoapUI.Report.Directory.Path}'
			if="${file::exists(SoapUI.Intermediate.Report.File.Path)}"
		/>
    
    <copy
			file='${SoapUI.Intermediate.Report.File.Path}'
			todir='${Common.ArtifactDirectoryPath}'
			if="${file::exists(SoapUI.Intermediate.Report.File.Path)}"
		/>
	  
		<ifthenelse  test="${file::exists(SoapUI.Report.File.Path)}">
			<then>
				<property name="SoapUI.HasFailures" value="true"/>
				<xmlpeek
					file="${SoapUI.Report.File.Path}"
					property="SoapUI.HasFailures"
					xpath="boolean(/testsuites//testsuite[@errors>0] or /testsuites//testsuite[@failures>0])"
				/>

				<fail
					if="${SoapUI.HasFailures}"
					message="At least one SoapUI has failed.  Please check the SoapUI section for more details..."
				/>
			</then>
			<else>
				<fail message="It doesn't look like any SoapUI were run, so the build was failed!"/>
			</else>
		</ifthenelse>
		
  </target>

 
  <target name="SoapUI.SetUp">
    <delete dir="${SoapUI.Intermediate.Report.Directory.Path}" if="${directory::exists(SoapUI.Intermediate.Report.Directory.Path)}"/>
    <mkdir dir="${SoapUI.Intermediate.Report.Directory.Path}"/>

    <delete dir="${SoapUI.Report.Directory.Path}" if="${directory::exists(SoapUI.Report.Directory.Path)}"/>
    <mkdir dir="${SoapUI.Report.Directory.Path}"/>
  </target>

  <target name="SoapUI.TearDown">

  </target>
</project>
